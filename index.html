<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>POS with Z Reading</title>
<style>
  body { font-family: sans-serif; display: flex; height: 100vh; margin: 0; }
  .products { flex: 2; display: grid; grid-template-columns: repeat(2,1fr); gap: 10px; padding: 10px; }
  .products button { font-size: 22px; padding: 25px; border-radius: 12px; }
  .side { flex: 1; display: flex; flex-direction: column; background: #f7f7f7; padding: 10px; }
  #cartDisplay { flex: 1; background: #fff; padding: 10px; overflow-y: auto; border: 1px solid #ccc; white-space: pre-line; }
  .keypad { display: grid; grid-template-columns: repeat(3,1fr); gap: 5px; margin-top: 10px; }
  .keypad button { font-size: 22px; padding: 20px; }
  .totals button { width: 100%; padding: 15px; font-size: 20px; margin-top: 5px; border-radius: 8px; }
</style>
</head>
<body>

<!-- Product Buttons -->
<div class="products">
  <button onclick="addItem('Milk')">Milk</button>
  <button onclick="addItem('Coffee')">Coffee</button>
  <button onclick="addItem('Sugar')">Sugar</button>
  <button onclick="addItem('Tea')">Tea</button>
</div>

<!-- Side Display -->
<div class="side">
  <h2>Cart</h2>
  <div id="cartDisplay"></div>

  <!-- Calculator Keypad -->
  <div class="keypad">
    <button onclick="enterNumber(1)">1</button>
    <button onclick="enterNumber(2)">2</button>
    <button onclick="enterNumber(3)">3</button>
    <button onclick="enterNumber(4)">4</button>
    <button onclick="enterNumber(5)">5</button>
    <button onclick="enterNumber(6)">6</button>
    <button onclick="enterNumber(7)">7</button>
    <button onclick="enterNumber(8)">8</button>
    <button onclick="enterNumber(9)">9</button>
    <button onclick="clearQty()">CLR</button>
    <button onclick="enterNumber(0)">0</button>
    <button onclick="setQty()">×</button>
  </div>

  <!-- Totals & Reports -->
  <div class="totals">
    <button onclick="showSubtotal()">Subtotal</button>
    <button onclick="showTotal()">Total</button>
    <button onclick="pay()">Pay & Print</button>
    <hr>
    <button onclick="initialReading()">Initial Reading</button>
    <button onclick="xReading()">X Reading</button>
    <button onclick="zReading()">Z Reading</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qz-tray/2.1.0/qz-tray.js"></script>
<script>
// Prices
let prices = { Milk: 50, Coffee: 30, Sugar: 40, Tea: 25 };
let cart = [];
let qtyBuffer = "";
let currentQty = 1;
let salesHistory = []; // all completed sales

// Keypad functions
function enterNumber(num) { qtyBuffer += num; currentQty = parseInt(qtyBuffer) || 1; }
function setQty() { if(qtyBuffer==="") currentQty=1; }
function clearQty() { qtyBuffer=""; currentQty=1; }

// Add item
function addItem(name) {
  let item = cart.find(i => i.name === name);
  if(item) {
    item.qty += currentQty;
    item.subtotal = item.qty * prices[name];
  } else {
    cart.push({ name, qty: currentQty, subtotal: currentQty * prices[name] });
  }
  clearQty();
  renderCart();
}

// Display cart
function renderCart() {
  let disp = "";
  cart.forEach(item => { disp += `${item.name} x${item.qty} = ₱${item.subtotal}\n`; });
  document.getElementById("cartDisplay").textContent = disp;
}

// Subtotal / Total
function showSubtotal() { alert("Subtotal: ₱" + cart.reduce((a,b)=>a+b.subtotal,0)); }
function showTotal() { alert("TOTAL: ₱" + cart.reduce((a,b)=>a+b.subtotal,0)); }

// Pay
function pay() {
  let total = cart.reduce((a,b)=>a+b.subtotal,0);
  if(total === 0) return alert("Cart is empty!");

  let sale = { time: new Date().toLocaleString(), cart: [...cart], total };
  salesHistory.push(sale);

  // Print receipt
  let cmds = [
    "\x1B\x40","   MY STORE\n","----------------------------\n"
  ];
  sale.cart.forEach(item => cmds.push(`${item.name} x${item.qty} = ₱${item.subtotal}\n`));
  cmds.push("----------------------------\n");
  cmds.push("TOTAL: ₱" + sale.total + "\n");
  cmds.push("----------------------------\n");
  cmds.push("THANK YOU!\n\n\n");
  cmds.push("\x1D\x56\x41"); // Cut
  cmds.push("\x1B\x70\x00\x19\xFA"); // Kick drawer

  let config = qz.configs.create("Your_Printer_Name");
  qz.print(config, cmds).catch(err=>console.error(err));

  cart = [];
  renderCart();
}

// --- Reports ---
function initialReading() {
  let cmds = [
    "\x1B\x40","   INITIAL READING\n",
    "Date: " + new Date().toLocaleString() + "\n",
    "Register Opened\n\n\n",
    "\x1D\x56\x41"
  ];
  qz.print(qz.configs.create("Your_Printer_Name"), cmds);
}

function xReading() {
  let totalSales = salesHistory.reduce((a,s)=>a+s.total,0);
  let cmds = [
    "\x1B\x40","   X READING\n",
    "Date: " + new Date().toLocaleString() + "\n",
    "Transactions: " + salesHistory.length + "\n",
    "Total Sales: ₱" + totalSales + "\n\n\n",
    "\x1D\x56\x41"
  ];
  qz.print(qz.configs.create("Your_Printer_Name"), cmds);
}

function zReading() {
  let totalSales = salesHistory.reduce((a,s)=>a+s.total,0);
  let cmds = [
    "\x1B\x40","   Z READING\n",
    "Date: " + new Date().toLocaleString() + "\n",
    "Transactions: " + salesHistory.length + "\n",
    "Total Sales: ₱" + totalSales + "\n",
    "REGISTER CLOSED\n\n\n",
    "\x1D\x56\x41"
  ];
  qz.print(qz.configs.create("Your_Printer_Name"), cmds);

  // Reset for new day/shift
  salesHistory = [];
}
</script>

</body>
</html>
