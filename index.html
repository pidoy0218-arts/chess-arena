<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>POS System - Full Supervisor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; font-family:Arial, sans-serif; display:flex; height:100vh; }
.cart, .items { padding:10px; box-sizing:border-box; }
.cart { width:50%; background:#f9f9f9; overflow-y:auto; }
.items { width:50%; background:#fff; overflow-y:auto; display:flex; flex-direction:column; }
.item-btn { padding:20px; margin:5px 0; font-size:20px; border:none; border-radius:8px; cursor:pointer; }
.cart-item { display:flex; align-items:center; justify-content:space-between; padding:8px; margin:4px 0; background:#eee; border-radius:6px; }
.cancel-btn { background:#999; color:#fff; border:none; border-radius:4px; padding:2px 6px; margin-right:8px; cursor:pointer; font-size:14px; }
.footer { position:absolute; bottom:0; left:0; width:100%; background:#222; color:#fff; padding:10px; display:flex; flex-wrap:wrap; align-items:center; }
.footer div { margin:5px 10px; font-size:18px; }
.cash-btn { padding:10px 20px; margin:3px; border:none; border-radius:6px; background:#007bff; color:#fff; font-size:16px; cursor:pointer; }
.pay-btn { padding:10px 20px; margin:3px; border:none; border-radius:6px; background:#28a745; color:#fff; font-size:18px; cursor:pointer; flex:1; }
.cash-input { padding:10px; margin:3px; border-radius:6px; border:1px solid #ccc; font-size:16px; width:120px; }

/* Supervisor overlay */
.supervisor-screen {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(240,240,240,0.95);
  z-index: 9999;
  padding: 15px;
  flex-direction: column;
  overflow-y: auto;
}
.supervisor-screen h2 { margin-top:0; }
.log-box, .item-box, .zhistory-box { max-height:250px; overflow-y:auto; background:#fff; padding:10px; border-radius:8px; margin-top:10px; }
.log-entry { border-bottom:1px solid #ccc; padding:6px 0; }
.log-entry:last-child { border-bottom:none; }
.back-btn, .action-btn, .tiny-btn { padding:6px 12px; margin:3px; border:none; border-radius:6px; cursor:pointer; }
.back-btn { background:#999; color:#fff; }
.action-btn { background:#007bff; color:#fff; }
.tiny-btn { font-size:12px; padding:3px 6px; background:#555; color:#fff; }
.reading-box { margin:10px 0; padding:10px; background:#fff; border-radius:8px; }
.reading-box div { margin:5px 0; font-weight:bold; }
</style>
</head>
<body>

<!-- CASHIER SCREEN -->
<div id="cashier-screen" style="display:flex; width:100%; height:100%;">
  <div class="cart" id="cart"></div>
  <div class="items" id="items"></div>
</div>

<div class="footer">
  <div id="subtotal">Subtotal: ₱0</div>
  <div id="total">Total: ₱0</div>
  <div id="change">Change: ₱0</div>
  <button class="cash-btn" onclick="cashTender(50)">₱50</button>
  <button class="cash-btn" onclick="cashTender(100)">₱100</button>
  <button class="cash-btn" onclick="cashTender(200)">₱200</button>
  <button class="cash-btn" onclick="cashTender(500)">₱500</button>
  <button class="cash-btn" onclick="cashTender(1000)">₱1000</button>
  <input class="cash-input" type="number" id="customCash" placeholder="Enter ₱" oninput="customCashTender()">
  <button class="pay-btn" onclick="payAndReset()">PAY & RESET</button>
  <button class="cash-btn" onclick="showSupervisor()">Supervisor</button>
</div>

<!-- SUPERVISOR SCREEN -->
<div class="supervisor-screen" id="supervisor-screen">
  <h2>Supervisor Login</h2>
  <p>Password: <input type="password" id="supPass"></p>
  <button class="action-btn" onclick="loginSupervisor()">Login</button>
  <button class="back-btn" onclick="hideSupervisor()">Back</button>

  <div id="supContent" style="display:none;">
    <!-- Readings -->
    <div class="reading-box">
      <div>X Reading: ₱<span id="xReading">0.0</span> 
        <button class="tiny-btn" onclick="resetX()">Reset X</button>
      </div>
      <div>Z Reading: ₱<span id="zReading">0.0</span> 
        <button class="tiny-btn" onclick="resetZ()">Reset Z</button>
      </div>
    </div>

    <h3>Change Supervisor Password</h3>
    <input type="password" id="newPass" placeholder="New password">
    <button class="action-btn" onclick="changeSupPass()">Update Password</button>

    <h3>Manage Items</h3>
    <input type="text" id="itemName" placeholder="Item Name">
    <input type="number" id="itemPrice" placeholder="Price">
    <select id="itemColor">
      <option value="#ffb3ba">Pastel Red</option>
      <option value="#ffdfba">Pastel Orange</option>
      <option value="#ffffba">Pastel Yellow</option>
      <option value="#baffc9">Pastel Green</option>
      <option value="#bae1ff">Pastel Blue</option>
      <option value="#e0b3ff">Pastel Purple</option>
    </select>
    <select id="itemTextColor">
      <option value="#000000">Black Text</option>
      <option value="#ffffff">White Text</option>
    </select>
    <button class="action-btn" onclick="addItemSupervisor()">Add Item</button>
    <div class="item-box" id="itemBox"></div>

    <h3>Transaction Logs</h3>
    <div class="log-box" id="logBox"></div>

    <h3>Z History</h3>
    <div class="zhistory-box" id="zhistoryBox"></div>
  </div>
</div>

<script>
// Simple beep
function beep(freq=440, dur=100){
  try {
    let ctx=new (window.AudioContext||window.webkitAudioContext)();
    let osc=ctx.createOscillator(); let gain=ctx.createGain();
    osc.type="sine"; osc.frequency.value=freq;
    osc.connect(gain); gain.connect(ctx.destination);
    osc.start();
    gain.gain.setValueAtTime(0.1,ctx.currentTime);
    osc.stop(ctx.currentTime+dur/1000);
  } catch(e) {}
}

// POS Variables
let cart = [];
let tendered = 0;

// Supervisor Data
if(!localStorage.getItem("SUPPASS")) localStorage.setItem("SUPPASS","pi123");
if(!localStorage.getItem("ITEMS")) {
  localStorage.setItem("ITEMS",JSON.stringify([
    {name:"Burger", price:50, color:"#ffb3ba", text:"#000000"},
    {name:"Fries", price:30, color:"#ffdfba", text:"#000000"},
    {name:"Coke", price:20, color:"#bae1ff", text:"#000000"}
  ]));
}
if(!localStorage.getItem("logs")) localStorage.setItem("logs","[]");
if(!localStorage.getItem("xReading")) localStorage.setItem("xReading","0");
if(!localStorage.getItem("zReading")) localStorage.setItem("zReading","0");
if(!localStorage.getItem("zhistory")) localStorage.setItem("zhistory","[]");

// Render items
function renderItems(){
  const itemsDiv = document.getElementById("items");
  itemsDiv.innerHTML="";
  let items = JSON.parse(localStorage.getItem("ITEMS"));
  items.forEach(i=>{
    let btn = document.createElement("button");
    btn.className="item-btn";
    btn.style.background=i.color;
    btn.style.color=i.text||"#000";
    btn.innerText=`${i.name} - ₱${i.price}`;
    btn.onclick=()=>addItemToCart(i.name,i.price);
    itemsDiv.appendChild(btn);
  });
}

// CART FUNCTIONS
function addItemToCart(name, price){
  let found = cart.find(i=>i.name===name);
  if(found) found.qty++;
  else cart.push({name, price, qty:1});
  beep(600,80);
  renderCart();
}
function cancelItem(index){
  if(cart[index].qty>1) cart[index].qty--;
  else cart.splice(index,1);
  beep(300,80);
  renderCart();
}
function renderCart(){
  const cartDiv = document.getElementById("cart");
  cartDiv.innerHTML="";
  let subtotal=0;
  cart.forEach((item,i)=>{
    subtotal+=item.price*item.qty;
    let div=document.createElement("div");
    div.className="cart-item";
    div.innerHTML=`<button class="cancel-btn" onclick="cancelItem(${i})">❌</button>${item.name} x${item.qty} = ₱${item.price*item.qty}`;
    cartDiv.appendChild(div);
  });
  document.getElementById("subtotal").textContent="Subtotal: ₱"+subtotal;
  document.getElementById("total").textContent="Total: ₱"+subtotal;
  document.getElementById("change").textContent="Change: ₱"+Math.max(0,tendered-subtotal);
}
function cashTender(amount){ tendered=amount; document.getElementById("customCash").value=amount; renderCart(); }
function customCashTender(){ let val=parseFloat(document.getElementById("customCash").value); tendered=isNaN(val)?0:val; renderCart(); }
function payAndReset(){
  if(cart.length===0){ alert("Cart is empty!"); return; }
  let subtotal=cart.reduce((a,b)=>a+b.price*b.qty,0);
  if(tendered<subtotal){ alert("Insufficient cash!"); return; }

  let logs = JSON.parse(localStorage.getItem("logs"));
  let date = new Date().toLocaleString();
  logs.push({date, cart:[...cart], total:subtotal});
  localStorage.setItem("logs",JSON.stringify(logs));

  // Update readings
  let x=parseFloat(localStorage.getItem("xReading"));
  let z=parseFloat(localStorage.getItem("zReading"));
  x+=subtotal; z+=subtotal;
  localStorage.setItem("xReading",x);
  localStorage.setItem("zReading",z);

  beep(800,150);
  alert("Payment successful! Change: ₱"+(tendered-subtotal));
  cart=[]; tendered=0; document.getElementById("customCash").value="";
  renderCart();
}

// SUPERVISOR SCREEN
function showSupervisor(){ document.getElementById("supervisor-screen").style.display="flex"; }
function hideSupervisor(){ document.getElementById("supervisor-screen").style.display="none"; document.getElementById("supContent").style.display="none"; document.getElementById("supPass").value=""; }
function loginSupervisor(){
  let pass = document.getElementById("supPass").value;
  if(pass===localStorage.getItem("SUPPASS")){
    document.getElementById("supContent").style.display="block";
    loadItemsSupervisor();
    loadLogs();
    loadZHistory();
    updateReadings();
  } else alert("Wrong password");
}

// Change supervisor password
function changeSupPass(){
  let newPass = document.getElementById("newPass").value;
  if(newPass===""){ alert("Enter a valid password"); return; }
  localStorage.setItem("SUPPASS",newPass);
  alert("Password updated!");
  document.getElementById("newPass").value="";
}

// ITEM MANAGEMENT
function loadItemsSupervisor(){
  const itemBox = document.getElementById("itemBox");
  itemBox.innerHTML="";
  let items = JSON.parse(localStorage.getItem("ITEMS"));
  items.forEach((i,index)=>{
    let div = document.createElement("div");
    div.style.display="flex"; div.style.justifyContent="space-between"; div.style.margin="4px 0"; div.style.alignItems="center";
    div.innerHTML = `${i.name} - ₱${i.price} 
      <div>
        <button class="action-btn" onclick="editItem(${index})">Edit</button>
        <button class="back-btn" onclick="removeItem(${index})">Remove</button>
      </div>`;
    itemBox.appendChild(div);
  });
}
function addItemSupervisor(){
  let name = document.getElementById("itemName").value;
  let price = parseFloat(document.getElementById("itemPrice").value);
  let color = document.getElementById("itemColor").value;
  let text = document.getElementById("itemTextColor").value;
  if(!name || isNaN(price)){ alert("Enter valid name and price"); return; }
  let items = JSON.parse(localStorage.getItem("ITEMS"));
  items.push({name, price, color, text});
  localStorage.setItem("ITEMS",JSON.stringify(items));
  document.getElementById("itemName").value="";
  document.getElementById("itemPrice").value="";
  renderItems(); loadItemsSupervisor();
}
function editItem(index){
  let items = JSON.parse(localStorage.getItem("ITEMS"));
  let i = items[index];
  let newName = prompt("Edit name:", i.name);
  if(newName===null) return;
  let newPrice = parseFloat(prompt("Edit price:", i.price));
  if(isNaN(newPrice)) return;
  items[index]={name:newName, price:newPrice, color:i.color, text:i.text};
  localStorage.setItem("ITEMS",JSON.stringify(items));
  renderItems(); loadItemsSupervisor();
}
function removeItem(index){
  let items = JSON.parse(localStorage.getItem("ITEMS"));
  if(confirm(`Remove ${items[index].name}?`)){
    items.splice(index,1);
    localStorage.setItem("ITEMS",JSON.stringify(items));
    renderItems(); loadItemsSupervisor();
  }
}

// TRANSACTION LOGS
function loadLogs(){
  let logs = JSON.parse(localStorage.getItem("logs"));
  let logBox = document.getElementById("logBox");
  logBox.innerHTML="";
  logs.forEach(l=>{
    let entry = document.createElement("div");
    entry.className="log-entry";
    let items = l.cart.map(i=>`${i.name} x${i.qty} = ₱${i.price*i.qty}`).join("<br>");
    entry.innerHTML = `<div><b>${l.date}</b></div><div>${items}</div><div><b>Total: ₱${l.total}</b></div>`;
    logBox.appendChild(entry);
  });
}

// READINGS
function updateReadings(){
  document.getElementById("xReading").textContent=parseFloat(localStorage.getItem("xReading")).toFixed(2);
  document.getElementById("zReading").textContent=parseFloat(localStorage.getItem("zReading")).toFixed(2);
}
function resetX(){
  localStorage.setItem("xReading","0");
  updateReadings();
}
function resetZ(){
  let z=parseFloat(localStorage.getItem("zReading"));
  let zhistory=JSON.parse(localStorage.getItem("zhistory"));
  let date=new Date().toLocaleString();
  zhistory.push({date,total:z});
  localStorage.setItem("zhistory",JSON.stringify(zhistory));
  localStorage.setItem("zReading","0");
  localStorage.setItem("xReading","0");
  updateReadings();
  loadZHistory();
  alert("Z Reset complete and logged.");
}

// Z HISTORY
function loadZHistory(){
  let zhistory=JSON.parse(localStorage.getItem("zhistory"));
  let box=document.getElementById("zhistoryBox");
  box.innerHTML="";
  zhistory.forEach(z=>{
    let div=document.createElement("div");
    div.className="log-entry";
    div.innerHTML=`<b>${z.date}</b> — Total: ₱${z.total.toFixed(2)}`;
    box.appendChild(div);
  });
}

// INITIAL RENDER
renderItems(); renderCart();
</script>

</body>
</html>
